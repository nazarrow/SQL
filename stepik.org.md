[![N|Solid](https://upload.wikimedia.org/wikipedia/commons/4/42/Stepik_logotype.png)](https://stepik.org/)
# Интерактивный тренажер по SQL (https://stepik.org/63054)
> Для форматирования использовал [https://codebeautify.org](https://codebeautify.org/sqlformatter#)
---
## 1. Основы реляционной модели и SQL

### 1.1 Отношение (таблица)

❓*Задание 1. Сформулируйте SQL запрос для создания таблицы book. Структура таблицы book:*

|Поле|Тип, описание|
|:---------------:|:---------------:|
|book_id|INT PRIMARY KEY AUTO_INCREMENT|
|title|VARCHAR(50)|
|author|INT PRIMARY KEY AUTO_INCREMENT|
|price|DECIMAL(8, 2)|
|amount|INT|

✅ `Решение` ⤵️

```sql
CREATE TABLE book (
  book_id INT PRIMARY KEY AUTO_INCREMENT, 
  title VARCHAR(50), 
  author VARCHAR(30), 
  price DECIMAL(8, 2), 
  amount INT
);
```

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Занесите новую строку в таблицу book (текстовые значения (тип VARCHAR) заключать либо в двойные, либо в одинарные кавычки):*

| book_id | title              | author        | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| INT PRIMARY KEY AUTO_INCREMENT      | VARCHAR(50) | INT PRIMARY KEY AUTO_INCREMENT | DECIMAL(8, 2) | INT     |

✅ `Решение` ⤵️

```sql
INSERT INTO book (
  book_id, title, author, price, amount
) 
VALUES 
  (
    1, "Мастер и Маргарита", 
    "Булгаков М.А.", 670.99, 
    3
  );
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title              | author        | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита | Булгаков М.А. | 670.99 | 3      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Занесите три последние записи в таблицу book,  первая запись уже добавлена на предыдущем шаге:*

| book_id | title              | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия      | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот              | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы  | Достоевский Ф.М. | 799.01 | 2      |

✅ `Решение` ⤵️

```sql
INSERT INTO book (
  book_id, title, author, price, amount
) 
VALUES 
  (
    2, "Белая гвардия", "Булгаков М.А.", 
    540.50, 5
  );
INSERT INTO book (
  book_id, title, author, price, amount
) 
VALUES 
  (
    3, "Идиот", "Достоевский Ф.М.", 
    460.00, 10
  );
INSERT INTO book (
  book_id, title, author, price, amount
) 
VALUES 
  (
    4, "Братья Карамазовы", 
    "Достоевский Ф.М.", 
    799.01, 2
  );
```

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.2 Выборка данных

❓*Задание 1. Вывести информацию о всех книгах, хранящихся на складе.
Для этого: 
Напишите SQL запрос в окне кода; 
Отправьте на проверку (кнопка  Отправить); 
Если запрос работает неверно, исправьте его и снова отправьте на проверку.*

✅ `Решение` ⤵️

```sql
SELECT 
  * 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Выбрать авторов, название книг и их цену из таблицы book.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title                 | price  |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Мастер и Маргарита    | 670.99 |
| Булгаков М.А.    | Белая гвардия         | 540.50 |
| Достоевский Ф.М. | Идиот                 | 460.00 |
| Достоевский Ф.М. | Братья Карамазовы     | 799.01 |
| Есенин С.А.      | Стихотворения и поэмы | 650.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Выбрать названия книг и авторов из таблицы book, для поля title задать имя(псевдоним) Название, для поля author –  Автор.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title AS Название, 
  author AS Автор 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| Название              | Автор            |
|:---------------:|:---------------:|
| Мастер и Маргарита    | Булгаков М.А.    |
| Белая гвардия         | Булгаков М.А.    |
| Идиот                 | Достоевский Ф.М. |
| Братья Карамазовы     | Достоевский Ф.М. |
| Стихотворения и поэмы | Есенин С.А.      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Для упаковки каждой книги требуется один лист бумаги, цена которого 1 рубль 65 копеек. Посчитать стоимость упаковки для каждой книги (сколько денег потребуется, чтобы упаковать все экземпляры книги). В запросе вывести название книги, ее количество и стоимость упаковки, последний столбец назвать pack.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  amount, 
  amount * 1.65 AS pack 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | amount | pack  |
|:---------------:|:---------------:|:---------------:|
| Мастер и Маргарита    | 3      | 4.95  |
| Белая гвардия         | 5      | 8.25  |
| Идиот                 | 10     | 16.50 |
| Братья Карамазовы     | 2      | 3.30  |
| Стихотворения и поэмы | 15     | 24.75 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. В конце года цену всех книг на складе пересчитывают – снижают ее на 30%. Написать SQL запрос, который из таблицы book выбирает названия, авторов, количества и вычисляет новые цены книг. Столбец с новой ценой назвать new_price, цену округлить до 2-х знаков после запятой.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author, 
  amount, 
  ROUND (
    (price * 0.7), 
    2
  ) AS new_price 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | author           | amount | new_price |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Мастер и Маргарита    | Булгаков М.А.    | 3      | 469.69    |
| Белая гвардия         | Булгаков М.А.    | 5      | 378.35    |
| Идиот                 | Достоевский Ф.М. | 10     | 322.00    |
| Братья Карамазовы     | Достоевский Ф.М. | 2      | 559.31    |
| Стихотворения и поэмы | Есенин С.А.      | 15     | 455.00    |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 6. При анализе продаж книг выяснилось, что наибольшей популярностью пользуются книги Михаила Булгакова, на втором месте книги Сергея Есенина. Исходя из этого решили поднять цену книг Булгакова на 10%, а цену книг Есенина - на 5%. Написать запрос, куда включить автора, название книги и новую цену, последний столбец назвать new_price. Значение округлить до двух знаков после запятой.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  ROUND (
    IF (
      author = "Булгаков М.А.", 
      price * 1.1, 
      IF (
        author = "Есенин С.А.", price * 1.05, 
        price * 1
      )
    ), 
    2
  ) AS new_price 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title                 | new_price |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Мастер и Маргарита    | 738.09    |
| Булгаков М.А.    | Белая гвардия         | 594.55    |
| Достоевский Ф.М. | Идиот                 | 460.00    |
| Достоевский Ф.М. | Братья Карамазовы     | 799.01    |
| Есенин С.А.      | Стихотворения и поэмы | 682.50    |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 7. Вывести автора, название  и цены тех книг, количество которых меньше 10.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  amount < 10;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title              | price  |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Мастер и Маргарита | 670.99 |
| Булгаков М.А.    | Белая гвардия      | 540.50 |
| Достоевский Ф.М. | Братья Карамазовы  | 799.01 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 8. Вывести название, автора,  цену  и количество всех книг, цена которых меньше 500 или больше 600, а стоимость всех экземпляров этих книг больше или равна 5000.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author, 
  price, 
  amount 
FROM 
  book 
WHERE 
  (
    price < 500 
    OR price > 600
  ) 
  AND price * amount >= 5000;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | author      | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Стихотворения и поэмы | Есенин С.А. | 650.00 | 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 9. Вывести название и авторов тех книг, цены которых принадлежат интервалу от 540.50 до 800 (включая границы),  а количество или 2, или 3, или 5, или 7 .*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author 
FROM 
  book 
WHERE 
  price BETWEEN 540.50 
  AND 800 
  AND amount IN (2, 3, 5, 7);
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title              | author           |
|:---------------:|:---------------:|
| Мастер и Маргарита | Булгаков М.А.    |
| Белая гвардия      | Булгаков М.А.    |
| Братья Карамазовы  | Достоевский Ф.М. |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 10. Вывести  автора и название  книг, количество которых принадлежит интервалу от 2 до 14 (включая границы). Информацию  отсортировать сначала по авторам (в обратном алфавитном порядке), а затем по названиям книг (по алфавиту).*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title 
FROM 
  book 
WHERE 
  amount BETWEEN 2 
  AND 14 
ORDER BY 
  1 DESC, 
  2 ASC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title              |
|:---------------:|:---------------:|
| Достоевский Ф.М. | Братья Карамазовы  |
| Достоевский Ф.М. | Идиот              |
| Булгаков М.А.    | Белая гвардия      |
| Булгаков М.А.    | Мастер и Маргарита |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 11. Вывести название и автора тех книг, название которых состоит из двух и более слов, а инициалы автора содержат букву «С». Считать, что в названии слова отделяются друг от друга пробелами и не содержат знаков препинания, между фамилией автора и инициалами обязателен пробел, инициалы записываются без пробела в формате: буква, точка, буква, точка. Информацию отсортировать по названию книги в алфавитном порядке.*
>Важно! Только для этого шага в таблицу добавлены новые записи.

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
| 6       |                       | Иванов С.С.      | 50.00  | 10     |
| 7       | Дети полуночи         | Рушди Салман     | 950.00 | 5      |
| 8       | Лирика                | Гумилев Н.С.     | 460.00 | 10     |
| 9       | Поэмы                 | Бехтерев С.С.    | 460.00 | 10     |
| 10      | Капитанская дочка     | Пушкин А.С.      | 520.50 | 7      |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author 
FROM 
  book 
WHERE 
  title LIKE "_% _%" 
  AND author LIKE "_% %С.%" 
ORDER BY 
  title;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | author      |
|:---------------:|:---------------:|
| Капитанская дочка     | Пушкин А.С. |
| Стихотворения и поэмы | Есенин С.А. |


┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.3 Запросы, групповые операции

❓*Задание 1. Отобрать различные (уникальные) элементы столбца amount таблицы book.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  amount 
FROM 
  book 
GROUP BY 
  amount;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| amount |
|:---------------:|
| 3      |
| 5      |
| 10     |
| 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Посчитать, количество различных книг и количество экземпляров книг каждого автора , хранящихся на складе.  Столбцы назвать Автор, Различных_книг и Количество_экземпляров соответственно.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author AS Автор, 
  COUNT(amount) AS Различных_книг, 
  SUM(amount) AS Количество_экземпляров 
FROM 
  book 
GROUP BY 
  author;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| Автор            | Различных_книг | Количество_экземпляров |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | 2              | 8                      |
| Достоевский Ф.М. | 3              | 23                     |
| Есенин С.А.      | 1              | 15                     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Вывести фамилию и инициалы автора, минимальную, максимальную и среднюю цену книг каждого автора . Вычисляемые столбцы назвать Минимальная_цена, Максимальная_цена и Средняя_цена соответственно.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  MIN(price) AS Минимальная_цена, 
  MAX(price) AS Максимальная_цена, 
  AVG(price) AS Средняя_цена 
FROM 
  book 
GROUP BY 
  author;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | Минимальная_цена | Максимальная_цена | Средняя_цена |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | 540.50           | 670.99            | 605.745000   |
| Достоевский Ф.М. | 460.00           | 799.01            | 579.836667   |
| Есенин С.А.      | 650.00           | 650.00            | 650.000000   |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Для каждого автора вычислить суммарную стоимость книг S (имя столбца Стоимость), а также вычислить налог на добавленную стоимость  для полученных сумм (имя столбца НДС ) , который включен в стоимость и составляет k = 18%,  а также стоимость книг  (Стоимость_без_НДС) без него. Значения округлить до двух знаков после запятой. В запросе для расчета НДС(tax)  и Стоимости без НДС(S_without_tax) использовать следующие формулы:*

`tax = (S * k/100) / (1 + k/100)`
`S_without_tax = S / (1 + k/100)`

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  SUM(price * amount) AS Стоимость, 
  ROUND(
    SUM(price * amount) * 0.18 / 1.18, 
    2
  ) AS НДС, 
  ROUND(
    SUM(price * amount) / 1.18, 
    2
  ) AS Стоимость_без_НДС 
FROM 
  book 
GROUP BY 
  author;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | Стоимость | НДС     | Стоимость_без_НДС |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | 4715.47   | 719.31  | 3996.16           |
| Достоевский Ф.М. | 11802.03  | 1800.31 | 10001.72          |
| Есенин С.А.      | 9750.00   | 1487.29 | 8262.71           |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Вывести  цену самой дешевой книги, цену самой дорогой и среднюю цену уникальных книг на складе. Названия столбцов Минимальная_цена, Максимальная_цена, Средняя_цена соответственно. Среднюю цену округлить до двух знаков после запятой.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  MIN(price) AS Минимальная_цена, 
  MAX(price) AS Максимальная_цена, 
  ROUND(
    AVG(price), 
    2
  ) AS Средняя_цена 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| Минимальная_цена | Максимальная_цена | Средняя_цена |
|:---------------:|:---------------:|:---------------:|
| 460.00           | 799.01            | 600.17       |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 6. Вычислить среднюю цену и суммарную стоимость тех книг, количество экземпляров которых принадлежит интервалу от 5 до 14, включительно. Столбцы назвать Средняя_цена и Стоимость, значения округлить до 2-х знаков после запятой.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  ROUND(
    AVG(price), 
    2
  ) AS Средняя_цена, 
  ROUND(
    SUM(price * amount), 
    2
  ) AS Стоимость 
FROM 
  book 
WHERE 
  amount BETWEEN 5 
  AND 14;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| Средняя_цена | Стоимость |
|:---------------:|:---------------:|
| 493.67       | 12107.50  |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 7. Посчитать стоимость всех экземпляров каждого автора без учета книг «Идиот» и «Белая гвардия». В результат включить только тех авторов, у которых суммарная стоимость книг (без учета книг «Идиот» и «Белая гвардия») более 5000 руб. Вычисляемый столбец назвать Стоимость. Результат отсортировать по убыванию стоимости.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  SUM(price * amount) AS Стоимость 
FROM 
  book 
WHERE 
  title <> "Идиот" 
  AND title <> "Белая гвардия" 
GROUP BY 
  author 
HAVING 
  SUM(price * amount) > 5000 
ORDER BY 
  Стоимость DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | Стоимость |
|:---------------:|:---------------:|
| Есенин С.А.      | 9750.00   |
| Достоевский Ф.М. | 7202.03   |

### 1.4 Вложенные запросы

❓*Задание 1. Вывести информацию (автора, название и цену) о  книгах, цены которых меньше или равны средней цене книг на складе. Информацию вывести в отсортированном по убыванию цены виде. Среднее вычислить как среднее по цене книги.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  price <= (
    SELECT 
      AVG(price) 
    FROM 
      book
  ) 
ORDER BY 
  price DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title         | price  |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Белая гвардия | 540.50 |
| Достоевский Ф.М. | Игрок         | 480.50 |
| Достоевский Ф.М. | Идиот         | 460.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Вывести информацию (автора, название и цену) о тех книгах, цены которых превышают минимальную цену книги на складе не более чем на 150 рублей в отсортированном по возрастанию цены виде.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
| 7       | Евгений Онегин        | Пушкин А.С.      | 610.00 | 10     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  price - (
    SELECT 
      MIN(price) 
    FROM 
      book
  ) <= 150 
ORDER BY 
  3 ASC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title          | price  |
|:---------------:|:---------------:|:---------------:|
| Достоевский Ф.М. | Идиот          | 460.00 |
| Достоевский Ф.М. | Игрок          | 480.50 |
| Булгаков М.А.    | Белая гвардия  | 540.50 |
| Пушкин А.С.      | Евгений Онегин | 610.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Вывести информацию (автора, книгу и количество) о тех книгах, количество экземпляров которых в таблице book не дублируется.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  amount 
FROM 
  book 
WHERE 
  amount IN (
    SELECT 
      amount 
    FROM 
      book 
    GROUP BY 
      amount 
    HAVING 
      COUNT(amount) = 1
  );
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author        | title                 | amount |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А. | Белая гвардия         | 5      |
| Есенин С.А.   | Стихотворения и поэмы | 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Вывести информацию о книгах(автор, название, цена), цена которых меньше самой большой из минимальных цен, вычисленных для каждого автора.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  price < ANY (
    SELECT 
      MIN(price) 
    FROM 
      book 
    GROUP BY 
      author
  );
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title         | price  |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Белая гвардия | 540.50 |
| Достоевский Ф.М. | Идиот         | 460.00 |
| Достоевский Ф.М. | Игрок         | 480.50 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Посчитать сколько и каких экземпляров книг нужно заказать поставщикам, чтобы на складе стало одинаковое количество экземпляров каждой книги, равное значению самого большего количества экземпляров одной книги на складе. Вывести название книги, ее автора, текущее количество экземпляров на складе и количество заказываемых экземпляров книг. Последнему столбцу присвоить имя Заказ. В результат не включать книги, которые заказывать не нужно.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author, 
  amount, 
  (
    SELECT 
      MAX(amount) 
    FROM 
      book
  ) - amount AS Заказ 
FROM 
  book 
WHERE 
  amount <> (
    SELECT 
      MAX(amount) 
    FROM 
      book
  );
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title              | author           | amount | Заказ |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Мастер и Маргарита | Булгаков М.А.    | 3      | 12    |
| Белая гвардия      | Булгаков М.А.    | 5      | 10    |
| Идиот              | Достоевский Ф.М. | 10     | 5     |
| Братья Карамазовы  | Достоевский Ф.М. | 3      | 12    |
| Игрок              | Достоевский Ф.М. | 10     | 5     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.5 Запросы корректировки данных

❓*Задание 1. Создать таблицу поставка (supply), которая имеет ту же структуру, что и таблиц book.*
