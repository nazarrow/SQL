[![N|Solid](https://upload.wikimedia.org/wikipedia/commons/4/42/Stepik_logotype.png)](https://stepik.org/)
# Интерактивный тренажер по SQL (https://stepik.org/63054)
> Для форматирования использовал [https://codebeautify.org](https://codebeautify.org/sqlformatter#)
---
## 1. Основы реляционной модели и SQL

### 1.1 Отношение (таблица)

❓*Задание 1. Сформулируйте SQL запрос для создания таблицы book. Структура таблицы book:*

|Поле|Тип, описание|
|:---------------:|:---------------:|
|book_id|INT PRIMARY KEY AUTO_INCREMENT|
|title|VARCHAR(50)|
|author|INT PRIMARY KEY AUTO_INCREMENT|
|price|DECIMAL(8, 2)|
|amount|INT|

✅ `Решение` ⤵️

```sql
CREATE TABLE book (
  book_id INT PRIMARY KEY AUTO_INCREMENT, 
  title VARCHAR(50), 
  author VARCHAR(30), 
  price DECIMAL(8, 2), 
  amount INT
);
```

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Занесите новую строку в таблицу book (текстовые значения (тип VARCHAR) заключать либо в двойные, либо в одинарные кавычки):*

| book_id | title              | author        | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| INT PRIMARY KEY AUTO_INCREMENT      | VARCHAR(50) | INT PRIMARY KEY AUTO_INCREMENT | DECIMAL(8, 2) | INT     |

✅ `Решение` ⤵️

```sql
INSERT INTO book (
  book_id, title, author, price, amount
) 
VALUES 
  (
    1, "Мастер и Маргарита", 
    "Булгаков М.А.", 670.99, 
    3
  );
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title              | author        | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита | Булгаков М.А. | 670.99 | 3      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Занесите три последние записи в таблицу book,  первая запись уже добавлена на предыдущем шаге:*

| book_id | title              | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия      | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот              | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы  | Достоевский Ф.М. | 799.01 | 2      |

✅ `Решение` ⤵️

```sql
INSERT INTO book (
  book_id, title, author, price, amount
) 
VALUES 
  (
    2, "Белая гвардия", "Булгаков М.А.", 
    540.50, 5
  );
INSERT INTO book (
  book_id, title, author, price, amount
) 
VALUES 
  (
    3, "Идиот", "Достоевский Ф.М.", 
    460.00, 10
  );
INSERT INTO book (
  book_id, title, author, price, amount
) 
VALUES 
  (
    4, "Братья Карамазовы", 
    "Достоевский Ф.М.", 
    799.01, 2
  );
```

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.2 Выборка данных

❓*Задание 1. Вывести информацию о всех книгах, хранящихся на складе.
Для этого: 
Напишите SQL запрос в окне кода; 
Отправьте на проверку (кнопка  Отправить); 
Если запрос работает неверно, исправьте его и снова отправьте на проверку.*

✅ `Решение` ⤵️

```sql
SELECT 
  * 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Выбрать авторов, название книг и их цену из таблицы book.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title                 | price  |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Мастер и Маргарита    | 670.99 |
| Булгаков М.А.    | Белая гвардия         | 540.50 |
| Достоевский Ф.М. | Идиот                 | 460.00 |
| Достоевский Ф.М. | Братья Карамазовы     | 799.01 |
| Есенин С.А.      | Стихотворения и поэмы | 650.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Выбрать названия книг и авторов из таблицы book, для поля title задать имя(псевдоним) Название, для поля author –  Автор.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title AS Название, 
  author AS Автор 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| Название              | Автор            |
|:---------------:|:---------------:|
| Мастер и Маргарита    | Булгаков М.А.    |
| Белая гвардия         | Булгаков М.А.    |
| Идиот                 | Достоевский Ф.М. |
| Братья Карамазовы     | Достоевский Ф.М. |
| Стихотворения и поэмы | Есенин С.А.      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Для упаковки каждой книги требуется один лист бумаги, цена которого 1 рубль 65 копеек. Посчитать стоимость упаковки для каждой книги (сколько денег потребуется, чтобы упаковать все экземпляры книги). В запросе вывести название книги, ее количество и стоимость упаковки, последний столбец назвать pack.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  amount, 
  amount * 1.65 AS pack 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | amount | pack  |
|:---------------:|:---------------:|:---------------:|
| Мастер и Маргарита    | 3      | 4.95  |
| Белая гвардия         | 5      | 8.25  |
| Идиот                 | 10     | 16.50 |
| Братья Карамазовы     | 2      | 3.30  |
| Стихотворения и поэмы | 15     | 24.75 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. В конце года цену всех книг на складе пересчитывают – снижают ее на 30%. Написать SQL запрос, который из таблицы book выбирает названия, авторов, количества и вычисляет новые цены книг. Столбец с новой ценой назвать new_price, цену округлить до 2-х знаков после запятой.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author, 
  amount, 
  ROUND (
    (price * 0.7), 
    2
  ) AS new_price 
FROM 
  book;
```

🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | author           | amount | new_price |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Мастер и Маргарита    | Булгаков М.А.    | 3      | 469.69    |
| Белая гвардия         | Булгаков М.А.    | 5      | 378.35    |
| Идиот                 | Достоевский Ф.М. | 10     | 322.00    |
| Братья Карамазовы     | Достоевский Ф.М. | 2      | 559.31    |
| Стихотворения и поэмы | Есенин С.А.      | 15     | 455.00    |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 6. При анализе продаж книг выяснилось, что наибольшей популярностью пользуются книги Михаила Булгакова, на втором месте книги Сергея Есенина. Исходя из этого решили поднять цену книг Булгакова на 10%, а цену книг Есенина - на 5%. Написать запрос, куда включить автора, название книги и новую цену, последний столбец назвать new_price. Значение округлить до двух знаков после запятой.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  ROUND (
    IF (
      author = "Булгаков М.А.", 
      price * 1.1, 
      IF (
        author = "Есенин С.А.", price * 1.05, 
        price * 1
      )
    ), 
    2
  ) AS new_price 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title                 | new_price |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Мастер и Маргарита    | 738.09    |
| Булгаков М.А.    | Белая гвардия         | 594.55    |
| Достоевский Ф.М. | Идиот                 | 460.00    |
| Достоевский Ф.М. | Братья Карамазовы     | 799.01    |
| Есенин С.А.      | Стихотворения и поэмы | 682.50    |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 7. Вывести автора, название  и цены тех книг, количество которых меньше 10.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  amount < 10;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title              | price  |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Мастер и Маргарита | 670.99 |
| Булгаков М.А.    | Белая гвардия      | 540.50 |
| Достоевский Ф.М. | Братья Карамазовы  | 799.01 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 8. Вывести название, автора,  цену  и количество всех книг, цена которых меньше 500 или больше 600, а стоимость всех экземпляров этих книг больше или равна 5000.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author, 
  price, 
  amount 
FROM 
  book 
WHERE 
  (
    price < 500 
    OR price > 600
  ) 
  AND price * amount >= 5000;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | author      | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Стихотворения и поэмы | Есенин С.А. | 650.00 | 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 9. Вывести название и авторов тех книг, цены которых принадлежат интервалу от 540.50 до 800 (включая границы),  а количество или 2, или 3, или 5, или 7 .*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author 
FROM 
  book 
WHERE 
  price BETWEEN 540.50 
  AND 800 
  AND amount IN (2, 3, 5, 7);
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title              | author           |
|:---------------:|:---------------:|
| Мастер и Маргарита | Булгаков М.А.    |
| Белая гвардия      | Булгаков М.А.    |
| Братья Карамазовы  | Достоевский Ф.М. |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 10. Вывести  автора и название  книг, количество которых принадлежит интервалу от 2 до 14 (включая границы). Информацию  отсортировать сначала по авторам (в обратном алфавитном порядке), а затем по названиям книг (по алфавиту).*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title 
FROM 
  book 
WHERE 
  amount BETWEEN 2 
  AND 14 
ORDER BY 
  1 DESC, 
  2 ASC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title              |
|:---------------:|:---------------:|
| Достоевский Ф.М. | Братья Карамазовы  |
| Достоевский Ф.М. | Идиот              |
| Булгаков М.А.    | Белая гвардия      |
| Булгаков М.А.    | Мастер и Маргарита |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 11. Вывести название и автора тех книг, название которых состоит из двух и более слов, а инициалы автора содержат букву «С». Считать, что в названии слова отделяются друг от друга пробелами и не содержат знаков препинания, между фамилией автора и инициалами обязателен пробел, инициалы записываются без пробела в формате: буква, точка, буква, точка. Информацию отсортировать по названию книги в алфавитном порядке.*
>Важно! Только для этого шага в таблицу добавлены новые записи.

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
| 6       |                       | Иванов С.С.      | 50.00  | 10     |
| 7       | Дети полуночи         | Рушди Салман     | 950.00 | 5      |
| 8       | Лирика                | Гумилев Н.С.     | 460.00 | 10     |
| 9       | Поэмы                 | Бехтерев С.С.    | 460.00 | 10     |
| 10      | Капитанская дочка     | Пушкин А.С.      | 520.50 | 7      |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author 
FROM 
  book 
WHERE 
  title LIKE "_% _%" 
  AND author LIKE "_% %С.%" 
ORDER BY 
  title;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | author      |
|:---------------:|:---------------:|
| Капитанская дочка     | Пушкин А.С. |
| Стихотворения и поэмы | Есенин С.А. |


┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.3 Запросы, групповые операции

❓*Задание 1. Отобрать различные (уникальные) элементы столбца amount таблицы book.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  amount 
FROM 
  book 
GROUP BY 
  amount;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| amount |
|:---------------:|
| 3      |
| 5      |
| 10     |
| 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Посчитать, количество различных книг и количество экземпляров книг каждого автора , хранящихся на складе.  Столбцы назвать Автор, Различных_книг и Количество_экземпляров соответственно.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author AS Автор, 
  COUNT(amount) AS Различных_книг, 
  SUM(amount) AS Количество_экземпляров 
FROM 
  book 
GROUP BY 
  author;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| Автор            | Различных_книг | Количество_экземпляров |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | 2              | 8                      |
| Достоевский Ф.М. | 3              | 23                     |
| Есенин С.А.      | 1              | 15                     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Вывести фамилию и инициалы автора, минимальную, максимальную и среднюю цену книг каждого автора . Вычисляемые столбцы назвать Минимальная_цена, Максимальная_цена и Средняя_цена соответственно.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  MIN(price) AS Минимальная_цена, 
  MAX(price) AS Максимальная_цена, 
  AVG(price) AS Средняя_цена 
FROM 
  book 
GROUP BY 
  author;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | Минимальная_цена | Максимальная_цена | Средняя_цена |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | 540.50           | 670.99            | 605.745000   |
| Достоевский Ф.М. | 460.00           | 799.01            | 579.836667   |
| Есенин С.А.      | 650.00           | 650.00            | 650.000000   |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Для каждого автора вычислить суммарную стоимость книг S (имя столбца Стоимость), а также вычислить налог на добавленную стоимость  для полученных сумм (имя столбца НДС ) , который включен в стоимость и составляет k = 18%,  а также стоимость книг  (Стоимость_без_НДС) без него. Значения округлить до двух знаков после запятой. В запросе для расчета НДС(tax)  и Стоимости без НДС(S_without_tax) использовать следующие формулы:*

`tax = (S * k/100) / (1 + k/100)`
`S_without_tax = S / (1 + k/100)`

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  SUM(price * amount) AS Стоимость, 
  ROUND(
    SUM(price * amount) * 0.18 / 1.18, 
    2
  ) AS НДС, 
  ROUND(
    SUM(price * amount) / 1.18, 
    2
  ) AS Стоимость_без_НДС 
FROM 
  book 
GROUP BY 
  author;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | Стоимость | НДС     | Стоимость_без_НДС |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | 4715.47   | 719.31  | 3996.16           |
| Достоевский Ф.М. | 11802.03  | 1800.31 | 10001.72          |
| Есенин С.А.      | 9750.00   | 1487.29 | 8262.71           |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Вывести  цену самой дешевой книги, цену самой дорогой и среднюю цену уникальных книг на складе. Названия столбцов Минимальная_цена, Максимальная_цена, Средняя_цена соответственно. Среднюю цену округлить до двух знаков после запятой.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  MIN(price) AS Минимальная_цена, 
  MAX(price) AS Максимальная_цена, 
  ROUND(
    AVG(price), 
    2
  ) AS Средняя_цена 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| Минимальная_цена | Максимальная_цена | Средняя_цена |
|:---------------:|:---------------:|:---------------:|
| 460.00           | 799.01            | 600.17       |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 6. Вычислить среднюю цену и суммарную стоимость тех книг, количество экземпляров которых принадлежит интервалу от 5 до 14, включительно. Столбцы назвать Средняя_цена и Стоимость, значения округлить до 2-х знаков после запятой.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  ROUND(
    AVG(price), 
    2
  ) AS Средняя_цена, 
  ROUND(
    SUM(price * amount), 
    2
  ) AS Стоимость 
FROM 
  book 
WHERE 
  amount BETWEEN 5 
  AND 14;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| Средняя_цена | Стоимость |
|:---------------:|:---------------:|
| 493.67       | 12107.50  |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 7. Посчитать стоимость всех экземпляров каждого автора без учета книг «Идиот» и «Белая гвардия». В результат включить только тех авторов, у которых суммарная стоимость книг (без учета книг «Идиот» и «Белая гвардия») более 5000 руб. Вычисляемый столбец назвать Стоимость. Результат отсортировать по убыванию стоимости.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  SUM(price * amount) AS Стоимость 
FROM 
  book 
WHERE 
  title <> "Идиот" 
  AND title <> "Белая гвардия" 
GROUP BY 
  author 
HAVING 
  SUM(price * amount) > 5000 
ORDER BY 
  Стоимость DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | Стоимость |
|:---------------:|:---------------:|
| Есенин С.А.      | 9750.00   |
| Достоевский Ф.М. | 7202.03   |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.4 Вложенные запросы

❓*Задание 1. Вывести информацию (автора, название и цену) о  книгах, цены которых меньше или равны средней цене книг на складе. Информацию вывести в отсортированном по убыванию цены виде. Среднее вычислить как среднее по цене книги.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  price <= (
    SELECT 
      AVG(price) 
    FROM 
      book
  ) 
ORDER BY 
  price DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title         | price  |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Белая гвардия | 540.50 |
| Достоевский Ф.М. | Игрок         | 480.50 |
| Достоевский Ф.М. | Идиот         | 460.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Вывести информацию (автора, название и цену) о тех книгах, цены которых превышают минимальную цену книги на складе не более чем на 150 рублей в отсортированном по возрастанию цены виде.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
| 7       | Евгений Онегин        | Пушкин А.С.      | 610.00 | 10     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  price - (
    SELECT 
      MIN(price) 
    FROM 
      book
  ) <= 150 
ORDER BY 
  3 ASC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title          | price  |
|:---------------:|:---------------:|:---------------:|
| Достоевский Ф.М. | Идиот          | 460.00 |
| Достоевский Ф.М. | Игрок          | 480.50 |
| Булгаков М.А.    | Белая гвардия  | 540.50 |
| Пушкин А.С.      | Евгений Онегин | 610.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Вывести информацию (автора, книгу и количество) о тех книгах, количество экземпляров которых в таблице book не дублируется.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  amount 
FROM 
  book 
WHERE 
  amount IN (
    SELECT 
      amount 
    FROM 
      book 
    GROUP BY 
      amount 
    HAVING 
      COUNT(amount) = 1
  );
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author        | title                 | amount |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А. | Белая гвардия         | 5      |
| Есенин С.А.   | Стихотворения и поэмы | 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Вывести информацию о книгах(автор, название, цена), цена которых меньше самой большой из минимальных цен, вычисленных для каждого автора.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  price < ANY (
    SELECT 
      MIN(price) 
    FROM 
      book 
    GROUP BY 
      author
  );
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title         | price  |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Белая гвардия | 540.50 |
| Достоевский Ф.М. | Идиот         | 460.00 |
| Достоевский Ф.М. | Игрок         | 480.50 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Посчитать сколько и каких экземпляров книг нужно заказать поставщикам, чтобы на складе стало одинаковое количество экземпляров каждой книги, равное значению самого большего количества экземпляров одной книги на складе. Вывести название книги, ее автора, текущее количество экземпляров на складе и количество заказываемых экземпляров книг. Последнему столбцу присвоить имя Заказ. В результат не включать книги, которые заказывать не нужно.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  author, 
  amount, 
  (
    SELECT 
      MAX(amount) 
    FROM 
      book
  ) - amount AS Заказ 
FROM 
  book 
WHERE 
  amount <> (
    SELECT 
      MAX(amount) 
    FROM 
      book
  );
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title              | author           | amount | Заказ |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Мастер и Маргарита | Булгаков М.А.    | 3      | 12    |
| Белая гвардия      | Булгаков М.А.    | 5      | 10    |
| Идиот              | Достоевский Ф.М. | 10     | 5     |
| Братья Карамазовы  | Достоевский Ф.М. | 3      | 12    |
| Игрок              | Достоевский Ф.М. | 10     | 5     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.5 Запросы корректировки данных

❓*Задание 1. Создать таблицу поставка (supply), которая имеет ту же структуру, что и таблиц book.*

| Поле              | Тип, описание           | 
|:---------------:|:---------------:|
| supply_id       | INT PRIMARY KEY AUTO_INCREMENT    | 
| title           | VARCHAR(50)    | 
| author          | VARCHAR(30) | 
| price           | DECIMAL(8, 2) | 
| amount          | INT |

✅ `Решение` ⤵️

```sql
CREATE TABLE supply (
  supply_id INT PRIMARY KEY AUTO_INCREMENT, 
  title VARCHAR(50), 
  author VARCHAR(30), 
  price DECIMAL(8, 2), 
  amount INT
);
```

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Занесите в таблицу supply четыре записи, чтобы получилась следующая таблица:*

| supply_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Лирика          | Пастернак Б.Л.	 | 518.99	 | 2      |
| 2       | Черный человек  | Есенин С.А.      | 570.20	 | 6     |
| 3       | Белая гвардия   | Булгаков М.А.    | 540.50 | 7     |
| 4       | Идиот           | Достоевский Ф.М. | 360.80 | 3      |

✅ `Решение` ⤵️

```sql
INSERT INTO supply (
  supply_id, title, author, price, amount
) 
VALUES 
  (
    1, "Лирика", "Пастернак Б.Л.", 
    518.99, 2
  ), 
  (
    2, "Черный человек", 
    "Есенин С.А.", 570.20, 6
  ), 
  (
    3, "Белая гвардия", "Булгаков М.А.", 
    540.50, 7
  ), 
  (
    4, "Идиот", "Достоевский Ф.М.", 
    360.80, 3
  );
  ```
🔎 `РЕЗУЛЬТАТ` ⤵️

| supply_id | title          | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Лирика         | Пастернак Б.Л.   | 518.99 | 2      |
| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия  | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Добавить из таблицы supply в таблицу book, все книги, кроме книг, написанных Булгаковым М.А. и Достоевским Ф.М.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

| supply_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Лирика          | Пастернак Б.Л.	 | 518.99	 | 2      |
| 2       | Черный человек  | Есенин С.А.      | 570.20	 | 6     |
| 3       | Белая гвардия   | Булгаков М.А.    | 540.50 | 7     |
| 4       | Идиот           | Достоевский Ф.М. | 360.80 | 3      |

✅ `Решение` ⤵️

```sql
INSERT INTO book (title, author, price, amount) 
SELECT 
  title, 
  author, 
  price, 
  amount 
FROM 
  supply 
WHERE 
  author NOT IN(
    "Булгаков М.А.", "Достоевский Ф.М."
  );
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
| 6       | Лирика                | Пастернак Б.Л.   | 518.99 | 2      |
| 7       | Черный человек        | Есенин С.А.      | 570.20 | 6      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Занести из таблицы supply в таблицу book только те книги, авторов которых нет в  book.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

| supply_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Лирика          | Пастернак Б.Л.	 | 518.99	 | 2      |
| 2       | Черный человек  | Есенин С.А.      | 570.20	 | 6     |
| 3       | Белая гвардия   | Булгаков М.А.    | 540.50 | 7     |
| 4       | Идиот           | Достоевский Ф.М. | 360.80 | 3      |

✅ `Решение` ⤵️

```sql
INSERT INTO book (title, author, price, amount) 
SELECT 
  title, 
  author, 
  price, 
  amount 
FROM 
  supply 
WHERE 
  author NOT IN(
    SELECT 
      author 
    FROM 
      book
  );
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
| 6       | Лирика                | Пастернак Б.Л.   | 518.99 | 2      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Уменьшить на 10% цену тех книг в таблице book, количество которых принадлежит интервалу от 5 до 10, включая границы.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
UPDATE 
  book 
SET 
  price = 0.9 * price 
WHERE 
  amount BETWEEN 5 
  AND 10;
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 486.45 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 414.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 6. В таблице book необходимо скорректировать значение для покупателя в столбце buy таким образом, чтобы оно не превышало количество экземпляров книг, указанных в столбце amount. А цену тех книг, которые покупатель не заказывал, снизить на 10%.*

| book_id | title                 | author           | price  | amount | buy |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 0   |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 3   |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 8   |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      | 0   |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 18  |

✅ `Решение` ⤵️

```sql
UPDATE 
  book 
SET 
  buy = IF(buy > amount, amount, buy), 
  price = IF(buy = 0, 0.9 * price, price);
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author           | price  | amount | buy |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 603.89 | 3      | 0   |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 3   |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 8   |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 719.11 | 2      | 0   |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 15  |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 7. Для тех книг в таблице book , которые есть в таблице supply, не только увеличить их количество в таблице book ( увеличить их количество на значение столбца amountтаблицы supply), но и пересчитать их цену (для каждой книги найти сумму цен из таблиц book и supply и разделить на 2).*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

| supply_id | title          | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Лирика         | Пастернак Б.Л.   | 518.99 | 2      |
| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия  | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |

✅ `Решение` ⤵️

```sql
UPDATE 
  book, 
  supply 
SET 
  book.amount = book.amount + supply.amount, 
  book.price = (book.price + supply.price)/ 2 
WHERE 
  book.title = supply.title 
  AND book.author = supply.author;
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 12     |
| 3       | Идиот                 | Достоевский Ф.М. | 410.40 | 13     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 8. Удалить из таблицы supply книги тех авторов, общее количество экземпляров книг которых в таблице book превышает 10.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

| supply_id | title          | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Лирика         | Пастернак Б.Л.   | 518.99 | 2      |
| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия  | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |

✅ `Решение` ⤵️

```sql
DELETE FROM 
  supply 
WHERE 
  author IN (
    SELECT 
      author 
    FROM 
      book 
    GROUP BY 
      author 
    HAVING 
      SUM(amount) > 10
  );
SELECT 
  * 
FROM 
  supply;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| supply_id | title         | author         | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Лирика        | Пастернак Б.Л. | 518.99 | 2      |
| 3         | Белая гвардия | Булгаков М.А.  | 540.50 | 7      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 9. Создать таблицу заказ (ordering), куда включить авторов и названия тех книг, количество экземпляров которых в таблице book меньше среднего количества экземпляров книг в таблице book. В таблицу включить столбец   amount, в котором для всех книг указать одинаковое значение - среднее количество экземпляров книг в таблице book.*

| book_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |

✅ `Решение` ⤵️

```sql
CREATE TABLE ordering AS 
SELECT 
  author, 
  title, 
  (
    SELECT 
      ROUND(
        AVG(amount)
      ) 
    FROM 
      book
  ) AS amount 
FROM 
  book 
WHERE 
  amount < (
    SELECT 
      ROUND(
        AVG(amount)
      ) 
    FROM 
      book
  );
SELECT 
  * 
FROM 
  ordering;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author           | title              | amount |
|:---------------:|:---------------:|:---------------:|
| Булгаков М.А.    | Мастер и Маргарита | 7      |
| Булгаков М.А.    | Белая гвардия      | 7      |
| Достоевский Ф.М. | Братья Карамазовы  | 7      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.6 Таблица "Командировки", запросы на выборку

❓*Задание 1. Вывести из таблицы trip информацию о командировках тех сотрудников, фамилия которых заканчивается на букву «а», в отсортированном по убыванию даты последнего дня командировки виде. В результат включить столбцы name, city, per_diem, date_first, date_last.*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  name, 
  city, 
  per_diem, 
  date_first, 
  date_last 
FROM 
  trip 
WHERE 
  name LIKE "%а %" 
ORDER by 
  date_last DESC;
SELECT 
  * 
FROM 
  trip;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| Федорова А.Ю. | Томск           | 450.00   | 2020-06-20 | 2020-06-26 |
| Абрамова К.А. | Санкт-Петербург | 700.00   | 2020-05-28 | 2020-06-04 |
| Федорова А.Ю. | Новосибирск     | 450.00   | 2020-05-25 | 2020-06-04 |
| Абрамова К.А. | Москва          | 700.00   | 2020-04-06 | 2020-04-14 |
| Абрамова К.А. | Москва          | 700.00   | 2020-02-23 | 2020-03-01 |
| Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Вывести в алфавитном порядке фамилии и инициалы тех сотрудников, которые были в командировке в Москве.*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  name 
FROM 
  trip 
WHERE 
  city = "Москва" 
GROUP BY 
  name 
ORDER BY 
  name ASC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name          |
|:---------------:|
| Абрамова К.А. |
| Баранов П.Е.  |
| Колесов С.П.  |
| Лебедев Т.К.  |
| Семенов И.В.  |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Для каждого города посчитать, сколько раз сотрудники в нем были.  Информацию вывести в отсортированном в алфавитном порядке по названию городов. Вычисляемый столбец назвать Количество.*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  city, 
  COUNT(name) AS Количество 
FROM 
  trip 
GROUP BY 
  city 
ORDER BY 
  city ASC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| city            | Количество |
|:---------------:|:---------------:|
| Владивосток     | 3          |
| Воронеж         | 1          |
| Москва          | 7          |
| Новосибирск     | 4          |
| Санкт-Петербург | 3          |
| Томск           | 2          |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Вывести два города, в которых чаще всего были в командировках сотрудники. Вычисляемый столбец назвать Количество.*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  city, 
  COUNT(name) AS Количество 
FROM 
  trip 
GROUP BY 
  city 
ORDER BY 
  2 DESC 
LIMIT 
  2;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| city        | Количество |
|:---------------:|:---------------:|
| Москва      | 7          |
| Новосибирск | 4          |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Вывести информацию о командировках во все города кроме Москвы и Санкт-Петербурга (фамилии и инициалы сотрудников, город ,  длительность командировки в днях, при этом первый и последний день относится к периоду командировки). Последний столбец назвать Длительность. Информацию вывести в упорядоченном по убыванию длительности поездки, а потом по убыванию названий городов (в обратном алфавитном порядке).*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  name, 
  city, 
  (
    DATEDIFF(date_last, date_first) + 1
  ) AS Длительность 
FROM 
  trip 
WHERE 
  city NOT IN (
    'Москва', 'Санкт-Петербург'
  ) 
ORDER BY 
  Длительность DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name          | city        | Длительность |
|:---------------:|:---------------:|:---------------:|
| Ильиных Г.Р.  | Владивосток | 22           |
| Баранов П.Е.  | Новосибирск | 17           |
| Колесов С.П.  | Новосибирск | 15           |
| Абрамова К.А. | Владивосток | 14           |
| Лебедев Т.К.  | Томск       | 12           |
| Абрамова К.А. | Владивосток | 12           |
| Федорова А.Ю. | Новосибирск | 11           |
| Колесов С.П.  | Новосибирск | 10           |
| Федорова А.Ю. | Томск       | 7            |
| Баранов П.Е.  | Воронеж     | 7            |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 6. Вывести информацию о командировках сотрудника(ов), которые были самыми короткими по времени. В результат включить столбцы name, city, date_first, date_last.*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  name, 
  city, 
  date_first, 
  date_last 
FROM 
  trip 
WHERE 
  DATEDIFF(date_last, date_first) IN(
    SELECT 
      MIN(
        DATEDIFF(date_last, date_first)
      ) 
    FROM 
      trip
  );
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name         | city            | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Семенов И.В. | Санкт-Петербург | 2020-06-01 | 2020-06-03 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 7. Вывести информацию о командировках, начало и конец которых относятся к одному месяцу (год может быть любой). В результат включить столбцы name, city, date_first, date_last. Строки отсортировать сначала в алфавитном порядке по названию города, а затем по фамилии сотрудника.*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  name, 
  city, 
  date_first, 
  date_last 
FROM 
  trip 
WHERE 
  MONTH(date_first) = MONTH(date_last) 
ORDER BY 
  city, 
  name;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name          | city            | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Абрамова К.А. | Владивосток     | 2020-01-14 | 2020-01-27 |
| Абрамова К.А. | Владивосток     | 2020-07-02 | 2020-07-13 |
| Баранов П.Е.  | Воронеж         | 2020-07-19 | 2020-07-25 |
| Абрамова К.А. | Москва          | 2020-04-06 | 2020-04-14 |
| Баранов П.Е.  | Москва          | 2020-01-12 | 2020-01-17 |
| Баранов П.Е.  | Москва          | 2020-02-14 | 2020-02-22 |
| Колесов С.П.  | Москва          | 2020-02-01 | 2020-02-06 |
| Лебедев Т.К.  | Москва          | 2020-03-03 | 2020-03-06 |
| Семенов И.В.  | Москва          | 2020-01-23 | 2020-01-31 |
| Колесов С.П.  | Новосибирск     | 2020-06-03 | 2020-06-12 |
| Семенов И.В.  | Санкт-Петербург | 2020-06-01 | 2020-06-03 |
| Лебедев Т.К.  | Томск           | 2020-05-20 | 2020-05-31 |
| Федорова А.Ю. | Томск           | 2020-06-20 | 2020-06-26 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 8. Вывести название месяца и количество командировок для каждого месяца. Считаем, что командировка относится к некоторому месяцу, если она началась в этом месяце. Информацию вывести сначала в отсортированном по убыванию количества, а потом в алфавитном порядке по названию месяца виде. Название столбцов – Месяц и Количество.*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  MONTHNAME(date_first) AS Месяц, 
  (
    COUNT(date_first)
  ) AS Количество 
FROM 
  trip 
GROUP BY 
  1 
ORDER BY 
  2 DESC, 
  1;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| Месяц    | Количество |
|:---------------:|:---------------:|
| February | 4          |
| January  | 4          |
| June     | 3          |
| May      | 3          |
| April    | 2          |
| July     | 2          |
| March    | 2          |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 9. Вывести сумму суточных (произведение количества дней командировки и размера суточных) для командировок, первый день которых пришелся на февраль или март 2020 года. Значение суточных для каждой командировки занесено в столбец per_diem. Вывести фамилию и инициалы сотрудника, город, первый день командировки и сумму суточных. Последний столбец назвать Сумма. Информацию отсортировать сначала  в алфавитном порядке по фамилиям сотрудников, а затем по убыванию суммы суточных.*

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  name, 
  city, 
  date_first, 
  (
    DATEDIFF(date_last + 1, date_first) * per_diem
  ) AS Сумма 
FROM 
  trip 
WHERE 
  MONTHNAME(date_first) IN("February", "March") 
ORDER BY 
  1, 
  4 DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name          | city            | date_first | Сумма   |
|:---------------:|:---------------:|:---------------:|:---------------:|
| Абрамова К.А. | Москва          | 2020-02-23 | 5600.00 |
| Баранов П.Е.  | Москва          | 2020-02-14 | 6300.00 |
| Колесов С.П.  | Новосибирск     | 2020-02-27 | 6750.00 |
| Колесов С.П.  | Москва          | 2020-02-01 | 4200.00 |
| Лебедев Т.К.  | Москва          | 2020-03-03 | 2800.00 |
| Семенов И.В.  | Санкт-Петербург | 2020-03-29 | 5600.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 10. Вывести фамилию с инициалами и общую сумму суточных, полученных за все командировки для тех сотрудников, которые были в командировках больше чем 3 раза, в отсортированном по убыванию сумм суточных виде. Последний столбец назвать Сумма.
Только для этого задания изменена строка таблицы trip:*

|4	|Ильиных Г.Р.	|Владивосток	|450	|2020-01-12	|2020-03-02|
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|

| trip_id | name          | city            | per_diem | date_first | date_last  |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Москва          | 700.00   | 2020-01-12 | 2020-01-17 |
| 2       | Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
| 3       | Семенов И.В.  | Москва          | 700.00   | 2020-01-23 | 2020-01-31 |
| 4       | Ильиных Г.Р.  | Владивосток     | 450.00   | 2020-01-12 | 2020-02-02 |
| 5       | Колесов С.П.  | Москва          | 700.00   | 2020-02-01 | 2020-02-06 |
| 6       | Баранов П.Е.  | Москва          | 700.00   | 2020-02-14 | 2020-02-22 |
|...|
| 19      | Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| 20      | Баранов П.Е.  | Воронеж         | 450.00   | 2020-07-19 | 2020-07-25 |

✅ `Решение` ⤵️

```sql
SELECT 
  name, 
  SUM(
    (
      DATEDIFF(date_last, date_first) + 1
    ) * per_diem
  ) AS Сумма 
FROM 
  trip 
WHERE 
  name IN(
    SELECT 
      name 
    FROM 
      trip 
    GROUP BY 
      name 
    HAVING 
      COUNT(name) > 3
  ) 
GROUP BY 
  name 
ORDER BY 
  2 DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name          | Сумма    |
|:---------------:|:---------------:|
| Абрамова К.А. | 29200.00 |
| Баранов П.Е.  | 21300.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 1.7 Таблица "Нарушения ПДД", запросы корректировки

❓*Задание 1. Создать таблицу fine следующей структуры:*

|Поле	          |Описание|
|:-------------:|:---------------:|
|fine_id	      |ключевой столбец целого типа с автоматическим увеличением значения ключа на 1|
|name	          |строка длиной 30|
|number_plate	  |строка длиной 6|
|violation	    |строка длиной 50|
|sum_fine	      |вещественное число, максимальная длина 8, количество знаков после запятой 2|
|date_violation	|дата|
|date_payment	  |дата|

✅ `Решение` ⤵️

```sql
CREATE TABLE fine (
  fine_id INT PRIMARY KEY AUTO_INCREMENT, 
  name VARCHAR(30), 
  number_plate VARCHAR(6), 
  violation VARCHAR(50), 
  sum_fine DECIMAL(8, 2), 
  date_violation DATE, 
  date_payment DATE
);
```
🔎 `РЕЗУЛЬТАТ` ⤵️

`Affected rows: 0`

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. В таблицу fine первые 5 строк уже занесены. Добавить в таблицу записи с ключевыми значениями 6, 7, 8.*

|fine_id	|name	|number_plate	|violation	|sum_fine	|date_violation	|date_payment|
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
|1	|Баранов П.Е.	|Р523ВТ	|Превышение скорости(от 40 до 60)	|500.00	    |2020-01-12	||2020-01-17|
|2	|Абрамова К.А.|О111АВ	|Проезд на запрещающий сигнал	    |1000.00	  |2020-01-14	|2020-02-27|
|3	|Яковлев Г.Р.	|Т330ТТ	|Превышение скорости(от 20 до 40)	|500.00	    |2020-01-23	|2020-02-23|
|4	|Яковлев Г.Р.	|М701АА	|Превышение скорости(от 20 до 40)	|           |2020-01-12 |	         | 
|5	|Колесов С.П.	|К892АХ	|Превышение скорости(от 20 до 40)	|         	|2020-02-01 |	         | 
|6	|Баранов П.Е.	|Р523ВТ	|Превышение скорости(от 40 до 60)	|           |2020-02-14 |	         |  
|7	|Абрамова К.А.|О111АВ	|Проезд на запрещающий сигнал	 	  |           |2020-02-23 |	         | 	 
|8	|Яковлев Г.Р.	|Т330ТТ	|Проезд на запрещающий сигнал	 	  |         	|2020-03-03 |	         |  

✅ `Решение` ⤵️

```sql
INSERT INTO fine (
  name, number_plate, violation, sum_fine, 
  date_violation, date_payment
) 
VALUES 
  (
    "Баранов П.Е.", "Р523ВТ", 
    "Превышение скорости(от 40 до 60)", 
    NULL, "2020-02-14", NULL
  ), 
  (
    "Абрамова К.А.", "О111АВ", 
    "Проезд на запрещающий сигнал", 
    NULL, "2020-02-23", NULL
  ), 
  (
    "Яковлев Г.Р.", "Т330ТТ", 
    "Проезд на запрещающий сигнал", 
    NULL, "2020-03-03", NULL
  );
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name          | number_plate | violation                        | sum_fine | date_violation   | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 500.00   | 2020-01-12       | 2020-01-17   |
| Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-01-14       | 2020-02-27   |
| Яковлев Г.Р.  | Т330ТТ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-01-23       | 2020-02-23   |
| Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20 до 40) | NULL     | 2020-01-12       | NULL         |
| Колесов С.П.  | К892АХ       | Превышение скорости(от 20 до 40) | NULL     | 2020-02-01       | NULL         |
| Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | NULL     | 2020-02-14       | NULL         |
| Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | NULL     | 2020-02-23       | NULL         |
| Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     | NULL     | 2020-03-03       | NULL         |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Занести в таблицу fine суммы штрафов, которые должен оплатить водитель, в соответствии с данными из таблицы traffic_violation. При этом суммы заносить только в пустые поля столбца  sum_fine.
Таблица traffic_violationсоздана и заполнена.*

| name          | number_plate | violation                    | sum_fine | date_violation | date_payment | 
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 500.00   | 2020-01-12     | 2020-01-17   |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигнал | 1000.00  | 2020-01-14     | 2020-02-27   |
| Яковлев Г.Р.  | Т330ТТ | Превышение скорости(от 20... | 500.00   | 2020-01-23     | 2020-02-23   |
| Яковлев Г.Р.  | М701АА | Превышение скорости(от 20... | NULL     | 2020-01-12     | NULL         |
| Колесов С.П.  | К892АХ | Превышение скорости(от 20... | NULL     | 2020-02-01     | NULL         |
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | NULL     | 2020-02-14     | NULL         |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигн...| NULL     | 2020-02-23     | NULL         |
| Яковлев Г.Р.  | Т330ТТ | Проезд на запрещающий сигн...| NULL     | 2020-03-03     | NULL         |

| violation_id | violation                        | sum_fine |
|:---------------:|:---------------:|:---------------:|
| 1            | Превышение скорости(от 20 до 40) | 500.00   |
| 2            | Превышение скорости(от 40 до 60) | 1000.00  |
| 3            | Проезд на запрещающий сигнал     | 1000.00  |

✅ `Решение` ⤵️

```sql
UPDATE 
  fine AS f, 
  traffic_violation AS tv 
SET 
  f.sum_fine = tv.sum_fine 
WHERE 
  f.sum_fine IS NULL 
  AND f.violation = tv.violation;
SELECT 
  * 
FROM 
  fine;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 500.00   | 2020-01-12     | 2020-01-17   |
| 2       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-01-14     | 2020-02-27   |
| 3       | Яковлев Г.Р.  | Т330ТТ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-01-23     | 2020-02-23   |
| 4       | Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20 до 40) | 500.00   | 2020-01-12     | NULL         |
| 5       | Колесов С.П.  | К892АХ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-02-01     | NULL         |
| 6       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 1000.00  | 2020-02-14     | NULL         |
| 7       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-02-23     | NULL         |
| 8       | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-03-03     | NULL         |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Вывести фамилию, номер машины и нарушение только для тех водителей, которые на одной машине нарушили одно и то же правило   два и более раз. При этом учитывать все нарушения, независимо от того оплачены они или нет. Информацию отсортировать в алфавитном порядке, сначала по фамилии водителя, потом по номеру машины и, наконец, по нарушению.*

| name          | number_plate | violation                    | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 500.00   | 2020-01-12     | 2020-01-17   |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигнал | 1000.00  | 2020-01-14     | 2020-02-27   |
| Яковлев Г.Р.  | Т330ТТ | Превышение скорости(от 20... | 500.00   | 2020-01-23     | 2020-02-23   |
| Яковлев Г.Р.  | М701АА | Превышение скорости(от 20... | 500.00   | 2020-01-12     | NULL         |
| Колесов С.П.  | К892АХ | Превышение скорости(от 20... | 500.00   | 2020-02-01     | NULL         |
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 1000.00  | 2020-02-14     | NULL         |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигн...| 1000.00  | 2020-02-23     | NULL         |
| Яковлев Г.Р.  | Т330ТТ | Проезд на запрещающий сигн...| 1000.00  | 2020-03-03     | NULL         |

✅ `Решение` ⤵️

```sql
SELECT 
  name, 
  number_plate, 
  violation 
FROM 
  fine 
GROUP BY 
  name, 
  number_plate, 
  violation 
HAVING 
  COUNT(violation) > 1 
ORDER BY 
  1, 
  2, 
  3;
SELECT 
  * 
FROM 
  fine;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 500.00   | 2020-01-12     | 2020-01-17   |
| 2       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-01-14     | 2020-02-27   |
| 3       | Яковлев Г.Р.  | Т330ТТ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-01-23     | 2020-02-23   |
| 4       | Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20 до 40) | 500.00   | 2020-01-12     | NULL         |
| 5       | Колесов С.П.  | К892АХ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-02-01     | NULL         |
| 6       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 1000.00  | 2020-02-14     | NULL         |
| 7       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-02-23     | NULL         |
| 8       | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-03-03     | NULL         |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. В таблице fine увеличить в два раза сумму неоплаченных штрафов для отобранных на предыдущем шаге записей.*

| name          | number_plate | violation                    | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 500.00   | 2020-01-12     | 2020-01-17   |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигнал | 1000.00  | 2020-01-14     | 2020-02-27   |
| Яковлев Г.Р.  | Т330ТТ | Превышение скорости(от 20... | 500.00   | 2020-01-23     | 2020-02-23   |
| Яковлев Г.Р.  | М701АА | Превышение скорости(от 20... | 500.00   | 2020-01-12     | NULL         |
| Колесов С.П.  | К892АХ | Превышение скорости(от 20... | 500.00   | 2020-02-01     | NULL         |
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 1000.00  | 2020-02-14     | NULL         |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигн...| 1000.00  | 2020-02-23     | NULL         |
| Яковлев Г.Р.  | Т330ТТ | Проезд на запрещающий сигн...| 1000.00  | 2020-03-03     | NULL         |

✅ `Решение` ⤵️

```sql
UPDATE 
  fine, 
  (
    SELECT 
      name, 
      number_plate, 
      violation 
    FROM 
      fine 
    GROUP BY 
      name, 
      number_plate, 
      violation 
    HAVING 
      COUNT(violation) > 1 
    ORDER BY 
      1, 
      2, 
      3
  ) AS query_in 
SET 
  fine.sum_fine = sum_fine * 2 
WHERE 
  date_payment IS NULL 
  AND fine.name = query_in.name 
  AND fine.number_plate = query_in.number_plate 
  AND fine.violation = query_in.violation;
SELECT 
  * 
FROM 
  fine;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 500.00   | 2020-01-12     | 2020-01-17   |
| 2       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-01-14     | 2020-02-27   |
| 3       | Яковлев Г.Р.  | Т330ТТ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-01-23     | 2020-02-23   |
| 4       | Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20 до 40) | 500.00   | 2020-01-12     | NULL         |
| 5       | Колесов С.П.  | К892АХ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-02-01     | NULL         |
| 6       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 2000.00  | 2020-02-14     | NULL         |
| 7       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 2000.00  | 2020-02-23     | NULL         |
| 8       | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-03-03     | NULL         |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 6. Водители оплачивают свои штрафы. В таблице payment занесены даты их оплаты:*

|payment_id	|name	|number_plate	|violation	|date_violation	|date_payment|
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
|1	|Яковлев Г.Р.	|М701АА	|Превышение скорости(от 20 до 40)	|2020-01-12	|2020-01-22|
|2	|Баранов П.Е.	|Р523ВТ	|Превышение скорости(от 40 до 60)	|2020-02-14	|2020-03-06|
|3	|Яковлев Г.Р.	|Т330ТТ	|Проезд на запрещающий сигнал	|2020-03-03	|2020-03-23|

*Необходимо:*
*в таблицу fine занести дату оплаты соответствующего штрафа из таблицы payment;* 
*уменьшить начисленный штраф в таблице fine в два раза  (только для тех штрафов, информация о которых занесена в таблицу payment) , если оплата произведена не позднее 20 дней со дня нарушения.*

✅ `Решение` ⤵️

```sql
UPDATE 
  fine AS f, 
  payment AS p 
SET 
  f.date_payment = p.date_payment, 
  f.sum_fine = IF (
    DATEDIFF(
      p.date_payment, p.date_violation
    ) <= 20, 
    f.sum_fine / 2, 
    f.sum_fine
  ) 
WHERE 
  f.name = p.name 
  AND f.number_plate = p.number_plate 
  AND f.violation = p.violation 
  AND f.date_violation = p.date_violation 
  AND f.date_payment IS NULL;
SELECT 
  * 
FROM 
  fine;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 500.00   | 2020-01-12     | 2020-01-17   |
| 2       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 1000.00  | 2020-01-14     | 2020-02-27   |
| 3       | Яковлев Г.Р.  | Т330ТТ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-01-23     | 2020-02-23   |
| 4       | Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20 до 40) | 250.00   | 2020-01-12     | 2020-01-22   |
| 5       | Колесов С.П.  | К892АХ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-02-01     | NULL         |
| 6       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 2000.00  | 2020-02-14     | 2020-03-06   |
| 7       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 2000.00  | 2020-02-23     | NULL         |
| 8       | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     | 500.00   | 2020-03-03     | 2020-03-23   |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 7. Создать новую таблицу back_payment, куда внести информацию о неоплаченных штрафах (Фамилию и инициалы водителя, номер машины, нарушение, сумму штрафа  и  дату нарушения) из таблицы fine.*

| name          | number_plate | violation                    | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 500.00   | 2020-01-12     | 2020-01-17   |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигнал | 1000.00  | 2020-01-14     | 2020-02-27   |
| Яковлев Г.Р.  | Т330ТТ | Превышение скорости(от 20... | 500.00   | 2020-01-23     | 2020-02-23   |
| Яковлев Г.Р.  | М701АА | Превышение скорости(от 20... | 250.00   | 2020-01-12     | 2020-01-22   |
| Колесов С.П.  | К892АХ | Превышение скорости(от 20... | 500.00   | 2020-02-01     | NULL         |
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 2000.00  | 2020-02-14     | 2020-03-05   |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигн...| 2000.00  | 2020-02-23     | NULL         |
| Яковлев Г.Р.  | Т330ТТ | Проезд на запрещающий сигн...| 500.00   | 2020-03-03     | 2020-03-22   |

✅ `Решение` ⤵️

```sql
CREATE TABLE back_payment AS 
SELECT 
  name, 
  number_plate, 
  violation, 
  sum_fine, 
  date_violation 
FROM 
  fine 
WHERE 
  date_payment IS NULL;
SELECT 
  * 
FROM 
  back_payment;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name          | number_plate | violation                        | sum_fine | date_violation |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Колесов С.П.  | К892АХ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-02-01     |
| Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 2000.00  | 2020-02-23     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 8. Удалить из таблицы fine информацию о нарушениях, совершенных раньше 1 февраля 2020 года.*

| name          | number_plate | violation                    | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 500.00   | 2020-01-12     | 2020-01-17   |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигнал | 1000.00  | 2020-01-14     | 2020-02-27   |
| Яковлев Г.Р.  | Т330ТТ | Превышение скорости(от 20... | 500.00   | 2020-01-23     | 2020-02-23   |
| Яковлев Г.Р.  | М701АА | Превышение скорости(от 20... | 250.00   | 2020-01-12     | 2020-01-22   |
| Колесов С.П.  | К892АХ | Превышение скорости(от 20... | 500.00   | 2020-02-01     | NULL         |
| Баранов П.Е.  | Р523ВТ | Превышение скорости(от 40... | 2000.00  | 2020-02-14     | 2020-03-05   |
| Абрамова К.А. | О111АВ | Проезд на запрещающий сигн...| 2000.00  | 2020-02-23     | NULL         |
| Яковлев Г.Р.  | Т330ТТ | Проезд на запрещающий сигн...| 500.00   | 2020-03-03     | 2020-03-22   |

✅ `Решение` ⤵️

```sql
DELETE FROM 
  fine 
WHERE 
  date_violation < "2020-02-01";
SELECT 
  * 
FROM 
  fine;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 5       | Колесов С.П.  | К892АХ       | Превышение скорости(от 20 до 40) | 500.00   | 2020-02-01     | NULL         |
| 6       | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) | 2000.00  | 2020-02-14     | 2020-03-05   |
| 7       | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     | 2000.00  | 2020-02-23     | NULL         |
| 8       | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     | 500.00   | 2020-03-03     | 2020-03-22   |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

## 2. Запросы SQL к связанным таблицам

### 2.1 Связи между таблицами

❓*Задание 1. Создать таблицу author следующей структуры:*

|Поле	|Тип, описание|
|:---------------:|:---------------:|
|author_id	|INT PRIMARY KEY AUTO_INCREMENT|
|name_author	|VARCHAR(50)|

✅ `Решение` ⤵️

```sql
CREATE TABLE author(
  author_id INT PRIMARY KEY AUTO_INCREMENT, 
  name_author VARCHAR(50)
);
```
🔎 `РЕЗУЛЬТАТ` ⤵️

`Affected rows: 0`

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Заполнить таблицу author. В нее включить следующих авторов:
-Булгаков М.А.
-Достоевский Ф.М.
-Есенин С.А.
-Пастернак Б.Л.*

✅ `Решение` ⤵️

```sql
INSERT INTO author (name_author) 
VALUES 
  ("Булгаков М.А."), 
  (
    "Достоевский Ф.М."
  ), 
  ("Есенин С.А."), 
  ("Пастернак Б.Л.");
SELECT 
  * 
FROM 
  author;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Перепишите запрос на создание таблицы book , чтобы ее структура соответствовала структуре, показанной на логической схеме (таблица genre уже создана, порядок следования столбцов - как на логической схеме в таблице book, genre_id  - внешний ключ) . Для genre_id ограничение о недопустимости пустых значений не задавать. В качестве главной таблицы для описания поля  genre_idиспользовать таблицу genre следующей структуры:*

|Поле	|Тип, описание|
|:---------------:|:---------------:|
|genre_id	|INT PRIMARY KEY AUTO_INCREMENT|
|name_genre	|VARCHAR(30)|

✅ `Решение` ⤵️

```sql
CREATE TABLE book (
  book_id INT PRIMARY KEY AUTO_INCREMENT, 
  title VARCHAR(50), 
  author_id INT NOT NULL, 
  genre_id INT, 
  price DECIMAL(8, 2), 
  amount INT, 
  FOREIGN KEY (author_id) REFERENCES author (author_id), 
  FOREIGN KEY (genre_id) REFERENCES genre (genre_id)
);
```
🔎 `РЕЗУЛЬТАТ` ⤵️

`Affected rows: 0`

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Создать таблицу book той же структуры, что и на предыдущем шаге. Будем считать, что при удалении автора из таблицы author, должны удаляться все записи о книгах из таблицы book, написанные этим автором. А при удалении жанра из таблицы genre для соответствующей записи book установить значение Null в столбце genre_id.*

✅ `Решение` ⤵️

```sql
CREATE TABLE book (
  book_id INT PRIMARY KEY AUTO_INCREMENT, 
  title VARCHAR(50), 
  author_id INT NOT NULL, 
  genre_id INT, 
  price DECIMAL(8, 2), 
  amount INT, 
  FOREIGN KEY (author_id) REFERENCES author (author_id) ON DELETE CASCADE, 
  FOREIGN KEY (genre_id) REFERENCES genre (genre_id) ON DELETE 
  SET 
    NULL
);
```
🔎 `РЕЗУЛЬТАТ` ⤵️

`Affected rows: 0`

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Добавьте три последние записи (с ключевыми значениями 6, 7, 8) в таблицу book, первые 5 записей уже добавлены:*

|book_id	|title	|author_id	|genre_id	|price	|amount|
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
|1	|Мастер и Маргарита	|1	|1	|670.99	|3|
|2	|Белая гвардия	|1	|1	|540.50	|5|
|3	|Идиот	|2	|1	|460.00	|10|
|4	|Братья Карамазовы	|2	|1	|799.01	|3|
|5	|Игрок	|2	|1	|480.50	|10|
|6	|Стихотворения и поэмы	|3	|2	|650.00	|15|
|7	|Черный человек	|3	|2	|570.20	|6|
|8	|Лирика	|4	|2	|518.99	|2|

*Логическая схема базы данных:*

![Логическая схема базы данных](https://ucarecdn.com/26d5d90a-3e95-46bc-807d-10fb53d10f25/)

✅ `Решение` ⤵️

```sql
INSERT INTO book(
  title, author_id, genre_id, price, 
  amount
) 
VALUES 
  (
    "Стихотворения и поэмы", 
    3, 2, 650.00, 15
  ), 
  (
    "Черный человек", 3, 
    2, 570.20, 6
  ), 
  ("Лирика", 4, 2, 518.99, 2);
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 2.2 Запросы на выборку, соединение таблиц

❓*Задание 1. Вывести название, жанр и цену тех книг, количество которых больше 8, в отсортированном по убыванию цены виде.*

*Логическая схема базы данных:*

![Логическая схема базы данных](https://ucarecdn.com/26d5d90a-3e95-46bc-807d-10fb53d10f25/)

*Таблица genre:*

| genre_id | name_genre  |
|:---------------:|:---------------:|
| 1        | Роман       |
| 2        | Поэзия      |
| 3        | Приключения |

*Таблица author:*

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |

*Таблица book:*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  name_genre, 
  price 
FROM 
  book 
  INNER JOIN genre ON book.genre_id = genre.genre_id 
WHERE 
  book.amount > 8 
ORDER BY 
  3 DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | name_genre | price  |
|:---------------:|:---------------:|:---------------:|
| Стихотворения и поэмы | Поэзия     | 650.00 |
| Игрок                 | Роман      | 480.50 |
| Идиот                 | Роман      | 460.00 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Вывести все жанры, которые не представлены в книгах на складе.*

*Логическая схема базы данных:*

![Логическая схема базы данных](https://ucarecdn.com/26d5d90a-3e95-46bc-807d-10fb53d10f25/)

*Таблица genre:*

| genre_id | name_genre  |
|:---------------:|:---------------:|
| 1        | Роман       |
| 2        | Поэзия      |
| 3        | Приключения |

*Таблица author:*

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |

*Таблица book:*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

✅ `Решение` ⤵️

```sql
SELECT 
  name_genre 
FROM 
  genre 
  LEFT JOIN book ON genre.genre_id = book.genre_id 
WHERE 
  book.genre_id IS NULL;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name_genre  |
|:---------------:|
| Приключения |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Есть список городов, хранящийся в таблице city:*

|city_id	|name_city|
|:---------------:|:---------------:|
|1	|Москва|
|2	|Санкт-Петербург|
|3	|Владивосток|

*Необходимо в каждом городе провести выставку книг каждого автора в течение 2020 года. Дату проведения выставки выбрать случайным образом. Создать запрос, который выведет город, автора и дату проведения выставки. Последний столбец назвать Дата. Информацию вывести, отсортировав сначала в алфавитном порядке по названиям городов, а потом по убыванию дат проведения выставок.*

*Структура таблицы:*

![Структура таблицы:](https://ucarecdn.com/4d2b7a6d-ef2f-4597-a12f-87b3af48494e/)

*Таблица genre:*

| genre_id | name_genre  |
|:---------------:|:---------------:|
| 1        | Роман       |
| 2        | Поэзия      |
| 3        | Приключения |

*Таблица author:*

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |

*Таблица city:*

| city_id | name_city       |
|:---------------:|:---------------:|
| 1       | Москва          |
| 2       | Санкт-Петербург |
| 3       | Владивосток     |

✅ `Решение` ⤵️

```sql
SELECT 
  name_city, 
  name_author, 
  (
    DATE_ADD(
      "2020-01-01", 
      INTERVAL FLOOR(
        RAND() * 365
      ) DAY
    )
  ) AS Дата 
FROM 
  author CROSS 
  JOIN city 
ORDER BY 
  1 ASC, 
  Дата DESC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name_city       | name_author      | Дата       |
|:---------------:|:---------------:|:---------------:|
| Владивосток     | Есенин С.А.      | 2020-11-29 |
| Владивосток     | Лермонтов М.Ю.   | 2020-09-28 |
| Владивосток     | Достоевский Ф.М. | 2020-06-11 |
| Владивосток     | Булгаков М.А.    | 2020-03-18 |
| Владивосток     | Пастернак Б.Л.   | 2020-02-08 |
| Москва          | Достоевский Ф.М. | 2020-12-07 |
| Москва          | Лермонтов М.Ю.   | 2020-07-11 |
| Москва          | Булгаков М.А.    | 2020-04-28 |
| Москва          | Пастернак Б.Л.   | 2020-02-14 |
| Москва          | Есенин С.А.      | 2020-01-30 |
| Санкт-Петербург | Есенин С.А.      | 2020-10-06 |
| Санкт-Петербург | Булгаков М.А.    | 2020-05-23 |
| Санкт-Петербург | Лермонтов М.Ю.   | 2020-05-08 |
| Санкт-Петербург | Пастернак Б.Л.   | 2020-04-14 |
| Санкт-Петербург | Достоевский Ф.М. | 2020-04-02 |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Вывести информацию о книгах (жанр, книга, автор), относящихся к жанру, включающему слово «роман» в отсортированном по названиям книг виде.*

*Логическая схема базы данных:*

![Логическая схема базы данных](https://ucarecdn.com/26d5d90a-3e95-46bc-807d-10fb53d10f25/)

*Таблица genre:*

| genre_id | name_genre  |
|:---------------:|:---------------:|
| 1        | Роман       |
| 2        | Поэзия      |
| 3        | Приключения |

*Таблица author:*

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |

*Таблица book:*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |


✅ `Решение` ⤵️

```sql
SELECT 
  name_genre, 
  title, 
  name_author 
FROM 
  book 
  JOIN genre ON book.genre_id = genre.genre_id 
  JOIN author ON book.author_id = author.author_id 
WHERE 
  name_genre = "Роман" 
ORDER BY 
  2;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name_genre | title              | name_author      |
|:---------------:|:---------------:|:---------------:|
| Роман      | Белая гвардия      | Булгаков М.А.    |
| Роман      | Братья Карамазовы  | Достоевский Ф.М. |
| Роман      | Игрок              | Достоевский Ф.М. |
| Роман      | Идиот              | Достоевский Ф.М. |
| Роман      | Мастер и Маргарита | Булгаков М.А.    |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Посчитать количество экземпляров  книг каждого автора из таблицы author.  Вывести тех авторов,  количество книг которых меньше 10, в отсортированном по возрастанию количества виде. Последний столбец назвать Количество.*

*Логическая схема базы данных:*

![Логическая схема базы данных](https://ucarecdn.com/26d5d90a-3e95-46bc-807d-10fb53d10f25/)

*Таблица genre:*

| genre_id | name_genre  |
|:---------------:|:---------------:|
| 1        | Роман       |
| 2        | Поэзия      |
| 3        | Приключения |

*Таблица author:*

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |

*Таблица book:*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |


✅ `Решение` ⤵️

```sql
SELECT 
  name_author, 
  SUM(amount) AS Количество 
FROM 
  author AS a 
  LEFT JOIN book AS b ON a.author_id = b.author_id 
GROUP BY 
  name_author 
HAVING 
  Количество < 10 
  OR Количество IS NULL 
ORDER BY 
  Количество ASC;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name_author    | Количество |
|:----------:|:---------------:|
| Лермонтов М.Ю. | NULL       |
| Пастернак Б.Л. | 2          |
| Булгаков М.А.  | 8          |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 6. Вывести в алфавитном порядке всех авторов, которые пишут только в одном жанре. Поскольку у нас в таблицах так занесены данные, что у каждого автора книги только в одном жанре,  для этого запроса внесем изменения в таблицу book. Пусть у нас  книга Есенина «Черный человек» относится к жанру «Роман», а книга Булгакова «Белая гвардия» к «Приключениям» (эти изменения в таблицы уже внесены).*

*Логическая схема базы данных:*

![Логическая схема базы данных](https://ucarecdn.com/26d5d90a-3e95-46bc-807d-10fb53d10f25/)

*Таблица genre:*

| genre_id | name_genre  |
|:---------------:|:---------------:|
| 1        | Роман       |
| 2        | Поэзия      |
| 3        | Приключения |

*Таблица author:*

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |

*Таблица book:*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 3        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 1        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

✅ `Решение` ⤵️

```sql
SELECT 
  name_author 
FROM 
  author AS a 
  JOIN book AS b ON b.author_id = a.author_id 
  JOIN genre AS g ON g.genre_id = b.genre_id 
GROUP BY 
  name_author 
HAVING 
  COUNT(
    DISTINCT(name_genre)
  ) = 1;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| name_author      |
|:---------------:|
| Достоевский Ф.М. |
| Пастернак Б.Л.   |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 7. Вывести информацию о книгах (название книги, фамилию и инициалы автора, название жанра, цену и количество экземпляров книги), написанных в самых популярных жанрах, в отсортированном в алфавитном порядке по названию книг виде. Самым популярным считать жанр, общее количество экземпляров книг которого на складе максимально.*

*Логическая схема базы данных:*

![Логическая схема базы данных](https://ucarecdn.com/26d5d90a-3e95-46bc-807d-10fb53d10f25/)

*Таблица genre:*

| genre_id | name_genre  |
|:---------------:|:---------------:|
| 1        | Роман       |
| 2        | Поэзия      |
| 3        | Приключения |

*Таблица author:*

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |

*Таблица book:*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 4       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 5       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 6       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 7       | Лирика                | 4         | 2        | 518.99 | 10     |
| 8       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 9       | Герой нашего времени  | 5         | 3        | 570.59 | 2      |
| 10      | Доктор Живаго         | 4         | 3        | 740.50 | 5      |

✅ `Решение` ⤵️

```sql
SELECT 
  title, 
  name_author, 
  name_genre, 
  price, 
  amount 
FROM 
  book 
  JOIN genre ON book.genre_id = genre.genre_id 
  JOIN author ON book.author_id = author.author_id 
WHERE 
  book.genre_id IN(
    SELECT 
      query_in_2.genre_id 
    FROM 
      (
        SELECT 
          genre.genre_id, 
          SUM(amount) AS sum_amount 
        FROM 
          genre 
          JOIN book ON genre.genre_id = book.genre_id 
        GROUP BY 
          book.genre_id 
        ORDER BY 
          sum_amount DESC 
        LIMIT 
          1
      ) query_in_1 
      JOIN (
        SELECT 
          genre.genre_id, 
          SUM(amount) AS sum_amount 
        FROM 
          genre 
          JOIN book ON genre.genre_id = book.genre_id 
        GROUP BY 
          book.genre_id 
        ORDER BY 
          sum_amount DESC
      ) query_in_2 ON query_in_1.sum_amount = query_in_2.sum_amount
  ) 
ORDER BY 
  title;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| title                 | name_author      | name_genre | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Белая гвардия         | Булгаков М.А.    | Роман      | 540.50 | 5      |
| Братья Карамазовы     | Достоевский Ф.М. | Роман      | 799.01 | 3      |
| Игрок                 | Достоевский Ф.М. | Роман      | 480.50 | 10     |
| Идиот                 | Достоевский Ф.М. | Роман      | 460.00 | 10     |
| Лирика                | Пастернак Б.Л.   | Поэзия     | 518.99 | 10     |
| Мастер и Маргарита    | Булгаков М.А.    | Роман      | 670.99 | 3      |
| Стихотворения и поэмы | Есенин С.А.      | Поэзия     | 650.00 | 15     |
| Черный человек        | Есенин С.А.      | Поэзия     | 570.20 | 6      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 8. Если в таблицах supply  и book есть одинаковые книги, которые имеют равную цену,  вывести их название и автора, а также посчитать общее количество экземпляров книг в таблицах supply и book,  столбцы назвать Название, Автор  и Количество.*

*Схема данных:*

![Схема данных:](https://ucarecdn.com/6de130b3-aac2-4216-82bb-7421c2a614ad/)

*Таблица supply:*

| supply_id | title          | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Доктор Живаго  | Пастернак Б.Л.   | 618.99 | 3      |
| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |
| 3         | Евгений Онегин | Пушкин А.С.      | 440.80 | 5      |
| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |

*Таблица author:*

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |

*Таблица book:*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

✅ `Решение` ⤵️

```sql
SELECT 
  title AS Название, 
  name_author AS Автор, 
  SUM(book.amount + supply.amount) AS Количество 
FROM 
  supply 
  INNER JOIN book USING(price, title) 
  INNER JOIN author ON author.name_author = supply.author 
GROUP BY 
  author.name_author, 
  book.title;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| Название       | Автор       | Количество |
|:---------------:|:---------------:|:---------------:|
| Черный человек | Есенин С.А. | 12         |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

### 2.3 Запросы корректировки, соединение таблиц

*Структура и наполнение  таблиц*
*Концептуальная схема базы данных:*

![](https://ucarecdn.com/f95c8b49-0d5c-45e0-9e35-6261f7cbbbe8/)

*Логическая схема базы данных:*

![](https://ucarecdn.com/95045d96-412d-4e10-88f2-7ac6b13fada6/)

❓*Задание 1. Для книг, которые уже есть на складе (в таблице book), но по другой цене, чем в поставке (supply),  необходимо в таблице book увеличить количество на значение, указанное в поставке,  и пересчитать цену. А в таблице  supply обнулить количество этих книг. Формула для пересчета цены:*  
*price = (p1∗k1 + p2∗k2) / (k1+k2)*  
*где  p1, p2 - цена книги в таблицах book и supply;*  
*k1, k2 - количество книг в таблицах book и supply.*

*Таблица book*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

*Таблица supply*

| supply_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Доктор Живаго         | Пастернак Б.Л.   | 380.80 | 4      |
| 2         | Черный человек        | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия         | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот                 | Достоевский Ф.М. | 360.80 | 3      |
| 5         | Стихотворения и поэмы | Лермонтов М.Ю.   | 255.90 | 4      |
| 6         | Остров сокровищ       | Стивенсон Р.Л.   | 599.99 | 5      |

*Таблица author*                          
	
| author_id | name_author      |			
|:---------------:|:---------------:|		
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |				
| 5         | Лермонтов М.Ю.   |

*Таблица genre*

| genre_id | name_genre  |	
|:---------------:|:---------------:|		
| 1        | Роман       |			
| 2        | Поэзия      |			
| 3        | Приключения |		

✅ `Решение` ⤵️

```sql
UPDATE 
  book 
  JOIN author ON author.author_id = book.author_id 
  JOIN supply ON book.title = supply.title 
  AND supply.author = author.name_author 
SET 
  book.amount = book.amount + supply.amount, 
  book.price = (
    book.price * book.amount + supply.price * supply.amount
  ) / (book.amount + supply.amount), 
  supply.amount = 0 
WHERE 
  book.price <> supply.price;
SELECT 
  * 
FROM 
  book;
SELECT 
  * 
FROM 
  supply;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

| supply_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Доктор Живаго         | Пастернак Б.Л.   | 380.80 | 4      |
| 2         | Черный человек        | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия         | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот                 | Достоевский Ф.М. | 360.80 | 0      |
| 5         | Стихотворения и поэмы | Лермонтов М.Ю.   | 255.90 | 4      |
| 6         | Остров сокровищ       | Стивенсон Р.Л.   | 599.99 | 5      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 2. Включить новых авторов в таблицу author с помощью запроса на добавление, а затем вывести все данные из таблицы author.  Новыми считаются авторы, которые есть в таблице supply, но нет в таблице author.*  

*Таблица book*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

*Таблица supply*

| supply_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Доктор Живаго         | Пастернак Б.Л.   | 380.80 | 4      |
| 2         | Черный человек        | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия         | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот                 | Достоевский Ф.М. | 360.80 | 3      |
| 5         | Стихотворения и поэмы | Лермонтов М.Ю.   | 255.90 | 4      |
| 6         | Остров сокровищ       | Стивенсон Р.Л.   | 599.99 | 5      |

*Таблица author*                          
	
| author_id | name_author      |			
|:---------------:|:---------------:|		
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |				
| 5         | Лермонтов М.Ю.   |

*Таблица genre*

| genre_id | name_genre  |	
|:---------------:|:---------------:|		
| 1        | Роман       |			
| 2        | Поэзия      |			
| 3        | Приключения |		

✅ `Решение` ⤵️

```sql
INSERT INTO author (name_author) 
SELECT 
  supply.author 
FROM 
  author 
  RIGHT JOIN supply ON author.name_author = supply.author 
WHERE 
  name_author IS NULL;
SELECT 
  * 
FROM 
  author;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author_id | name_author      |
|:---------------:|:---------------:|
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |
| 6         | Стивенсон Р.Л.   |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 3. Добавить новые книги из таблицы supply в таблицу book на основе сформированного выше запроса. Затем вывести для просмотра таблицу book.*  

```sql
SELECT title, author_id, price, amount
FROM 
    author 
    INNER JOIN supply ON author.name_author = supply.author
WHERE amount <> 0;
```

*Таблица book*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |

*Таблица supply*

| supply_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Доктор Живаго         | Пастернак Б.Л.   | 380.80 | 4      |
| 2         | Черный человек        | Есенин С.А.      | 570.20 | 0      |
| 3         | Белая гвардия         | Булгаков М.А.    | 540.50 | 0      |
| 4         | Идиот                 | Достоевский Ф.М. | 360.80 | 0      |
| 5         | Стихотворения и поэмы | Лермонтов М.Ю.   | 255.90 | 4      |
| 6         | Остров сокровищ       | Стивенсон Р.Л.   | 599.99 | 5      |

*Таблица author*                          
	
| author_id | name_author      |			
|:---------------:|:---------------:|		
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |				
| 5         | Лермонтов М.Ю.   |
| 6         | Стивенсон Р.Л.   |

*Таблица genre*

| genre_id | name_genre  |	
|:---------------:|:---------------:|		
| 1        | Роман       |			
| 2        | Поэзия      |			
| 3        | Приключения |		

✅ `Решение` ⤵️

```sql
INSERT INTO book(title, author_id, price, amount) 
SELECT 
  title, 
  author_id, 
  price, 
  amount 
FROM 
  author 
  INNER JOIN supply ON author.name_author = supply.author 
WHERE 
  amount <> 0;
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | NULL     | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | NULL     | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | NULL     | 599.99 | 5      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 4. Занести для книги «Стихотворения и поэмы» Лермонтова жанр «Поэзия», а для книги «Остров сокровищ» Стивенсона - «Приключения». (Использовать два запроса).*  

*Таблица book*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | 1        | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | Null     | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | Null     | 599.99 | 5      |

*Таблица author*                          
	
| author_id | name_author      |			
|:---------------:|:---------------:|		
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |				
| 5         | Лермонтов М.Ю.   |
| 6         | Стивенсон Р.Л.   |

*Таблица genre*

| genre_id | name_genre  |	
|:---------------:|:---------------:|		
| 1        | Роман       |			
| 2        | Поэзия      |			
| 3        | Приключения |		

✅ `Решение` ⤵️

```sql
UPDATE 
  book 
SET 
  genre_id = (
    SELECT 
      genre_id 
    FROM 
      genre 
    WHERE 
      name_genre = "Поэзия"
  ) 
WHERE 
  book.title = "Стихотворения и поэмы";
UPDATE 
  book 
SET 
  genre_id = (
    SELECT 
      genre_id 
    FROM 
      genre 
    WHERE 
      name_genre = "Приключения"
  ) 
WHERE 
  book.title = "Остров сокровищ";
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | 1        | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | 2        | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | 3        | 599.99 | 5      |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉

❓*Задание 5. Удалить всех авторов и все их книги, общее количество книг которых меньше 20.*  

*Таблица book*

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | 1        | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | 2        | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | 3        | 599.99 | 5      |

*Таблица supply*

| supply_id | title                 | author           | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 1         | Доктор Живаго         | Пастернак Б.Л.   | 380.80 | 4      |
| 2         | Черный человек        | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия         | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот                 | Достоевский Ф.М. | 360.80 | 3      |
| 5         | Стихотворения и поэмы | Лермонтов М.Ю.   | 255.90 | 4      |
| 6         | Остров сокровищ       | Стивенсон Р.Л.   | 599.99 | 5      |

*Таблица author*                          
	
| author_id | name_author      |			
|:---------------:|:---------------:|		
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |				
| 5         | Лермонтов М.Ю.   |
| 6         | Стивенсон Р.Л.   |

*Таблица genre*

| genre_id | name_genre  |	
|:---------------:|:---------------:|		
| 1        | Роман       |			
| 2        | Поэзия      |			
| 3        | Приключения |		

✅ `Решение` ⤵️

```sql
DELETE FROM 
  author 
WHERE 
  author_id IN (
    SELECT 
      author_id 
    FROM 
      book 
    GROUP BY 
      author_id 
    HAVING 
      SUM(amount) < 20
  );
SELECT 
  * 
FROM 
  author;
SELECT 
  * 
FROM 
  book;
```
🔎 `РЕЗУЛЬТАТ` ⤵️

| author_id | name_author      |
|:---------------:|:---------------:|
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |

| book_id | title                 | author_id | genre_id | price  | amount |
|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |

┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉


